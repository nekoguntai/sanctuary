<mxfile host="app.diagrams.net" agent="5.0" version="24.7.17">
  <diagram name="Architecture" id="architecture-diagram">
    <mxGraphModel dx="1434" dy="880" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="Sanctuary Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;fontColor=#1a1a2e;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="300" height="40" as="geometry" />
        </mxCell>

        <!-- Browser Section -->
        <mxCell id="browser-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="320" y="70" width="460" height="90" as="geometry" />
        </mxCell>
        <mxCell id="browser-label" value="Your Browser" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="75" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="web-ui" value="Sanctuary Web UI&#xa;(React + WebUSB)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="380" y="100" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="hw-wallet" value="Hardware Wallet&#xa;(Ledger/Trezor)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="100" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="webusb-arrow" value="" style="endArrow=classic;startArrow=classic;html=1;strokeWidth=2;strokeColor=#d6b656;" edge="1" parent="1" source="web-ui" target="hw-wallet">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <!-- HTTPS Arrow from Browser to Docker -->
        <mxCell id="https-arrow" value="HTTPS :8443" style="endArrow=classic;startArrow=classic;html=1;strokeWidth=2;strokeColor=#6c8ebf;fontStyle=1;fontSize=11;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="160" as="sourcePoint" />
            <mxPoint x="460" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Docker Compose Stack -->
        <mxCell id="docker-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="40" y="200" width="1020" height="420" as="geometry" />
        </mxCell>
        <mxCell id="docker-label" value="Docker Compose Stack" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#5c2d91;" vertex="1" parent="1">
          <mxGeometry x="430" y="205" width="200" height="25" as="geometry" />
        </mxCell>

        <!-- Frontend -->
        <mxCell id="frontend" value="Frontend&#xa;(nginx)&#xa;:8443" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="60" y="250" width="100" height="70" as="geometry" />
        </mxCell>

        <!-- Backend -->
        <mxCell id="backend" value="Backend&#xa;(Node.js API)&#xa;:3001" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="200" y="250" width="120" height="70" as="geometry" />
        </mxCell>

        <!-- Worker (NEW) -->
        <mxCell id="worker-group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="360" y="240" width="300" height="160" as="geometry" />
        </mxCell>
        <mxCell id="worker-label" value="Worker (Background Jobs) :3002" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=13;fontStyle=1;fontColor=#b45f06;" vertex="1" parent="1">
          <mxGeometry x="390" y="245" width="240" height="20" as="geometry" />
        </mxCell>
        <mxCell id="worker-new-badge" value="NEW" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;fontSize=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="620" y="245" width="35" height="18" as="geometry" />
        </mxCell>
        <mxCell id="electrum-mgr" value="Electrum Manager&#xa;(Subscriptions)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;strokeWidth=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="375" y="270" width="130" height="45" as="geometry" />
        </mxCell>
        <mxCell id="sync-jobs" value="Sync Jobs&#xa;(Wallet Sync)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;strokeWidth=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="515" y="270" width="130" height="45" as="geometry" />
        </mxCell>
        <mxCell id="notification-jobs" value="Notification Jobs&#xa;(Telegram/Push)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;strokeWidth=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="375" y="325" width="130" height="45" as="geometry" />
        </mxCell>
        <mxCell id="confirmation-jobs" value="Confirmation Jobs&#xa;(Block Updates)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;strokeWidth=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="515" y="325" width="130" height="45" as="geometry" />
        </mxCell>

        <!-- Gateway -->
        <mxCell id="gateway" value="Gateway&#xa;(Mobile API)&#xa;:4000" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="700" y="250" width="120" height="70" as="geometry" />
        </mxCell>

        <!-- Redis -->
        <mxCell id="redis" value="Redis&#xa;(Jobs + Cache)&#xa;:6379" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;fontSize=12;fontStyle=1;fillStyle=solid;" vertex="1" parent="1">
          <mxGeometry x="200" y="440" width="120" height="70" as="geometry" />
        </mxCell>

        <!-- PostgreSQL -->
        <mxCell id="postgres" value="PostgreSQL&#xa;(Database)&#xa;:5432" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="440" y="430" width="120" height="90" as="geometry" />
        </mxCell>

        <!-- Connections -->
        <!-- Frontend to Backend -->
        <mxCell id="fe-be" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#82b366;" edge="1" parent="1" source="frontend" target="backend">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <!-- Backend to Worker (via Redis) -->
        <mxCell id="be-redis" value="" style="endArrow=classic;startArrow=classic;html=1;strokeWidth=2;strokeColor=#666666;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="backend" target="redis">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <!-- Worker to Redis -->
        <mxCell id="worker-redis" value="" style="endArrow=classic;startArrow=classic;html=1;strokeWidth=2;strokeColor=#666666;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="worker-group" target="redis">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <!-- Backend to Postgres -->
        <mxCell id="be-pg" value="" style="endArrow=classic;startArrow=classic;html=1;strokeWidth=2;strokeColor=#6c8ebf;" edge="1" parent="1" source="backend" target="postgres">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <!-- Worker to Postgres -->
        <mxCell id="worker-pg" value="" style="endArrow=classic;startArrow=classic;html=1;strokeWidth=2;strokeColor=#6c8ebf;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="worker-group" target="postgres">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <!-- Gateway to Backend -->
        <mxCell id="gw-be" value="WebSocket" style="endArrow=classic;startArrow=classic;html=1;strokeWidth=2;strokeColor=#82b366;fontStyle=1;fontSize=10;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="gateway" target="backend">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <!-- External: Mobile Apps -->
        <mxCell id="mobile-apps" value="Mobile Apps&#xa;(iOS / Android)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="860" y="250" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="gw-mobile" value="HTTPS" style="endArrow=classic;startArrow=classic;html=1;strokeWidth=2;strokeColor=#b85450;fontStyle=1;fontSize=10;" edge="1" parent="1" source="gateway" target="mobile-apps">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <!-- External: Electrum Server -->
        <mxCell id="electrum-server" value="Bitcoin Network&#xa;(Electrum Server)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="860" y="440" width="140" height="70" as="geometry" />
        </mxCell>
        <mxCell id="worker-electrum" value="TCP/SSL&#xa;(Real-time)" style="endArrow=classic;startArrow=classic;html=1;strokeWidth=2;strokeColor=#d6b656;fontStyle=1;fontSize=10;exitX=1;exitY=0.75;exitDx=0;exitDy=0;" edge="1" parent="1" source="worker-group" target="electrum-server">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="750" y="360" />
              <mxPoint x="750" y="475" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="60" y="530" width="280" height="80" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="70" y="535" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-ui" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="70" y="560" width="20" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend-ui-text" value="Frontend / UI" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="95" y="557" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-api" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="70" y="580" width="20" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend-api-text" value="API Server" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="95" y="577" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-worker" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="180" y="560" width="20" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend-worker-text" value="Background Worker" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="205" y="557" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-mobile" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="180" y="580" width="20" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend-mobile-text" value="Mobile / Gateway" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="205" y="577" width="120" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
