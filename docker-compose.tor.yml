# =============================================
# Sanctuary - Tor Proxy Service
# =============================================
#
# Optional Tor SOCKS5 proxy for routing Electrum connections
# through the Tor network for enhanced privacy.
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.tor.yml up -d
#
# Or enable via install.sh or start.sh:
#   ./start.sh --with-tor
#
# Configuration:
#   In Node Configuration â†’ Proxy / Tor settings:
#   - Enable proxy
#   - Select "Tor Container" preset (tor:9050)
#
# =============================================

services:
  # ============================================
  # Tor - SOCKS5 Proxy
  # ============================================
  # Provides a Tor SOCKS5 proxy that Sanctuary can use
  # to route Electrum server connections through Tor.
  # This enhances privacy by hiding your IP from
  # Electrum servers.
  # ============================================
  tor:
    image: dperson/torproxy:latest
    container_name: sanctuary-tor
    restart: unless-stopped
    networks:
      - sanctuary-network
    environment:
      # Disable exit node functionality - we only need SOCKS proxy
      LOCATION: ""
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 128M
        reservations:
          cpus: '0.1'
          memory: 64M
    healthcheck:
      test: ["CMD-SHELL", "curl --socks5 localhost:9050 --socks5-hostname localhost:9050 -s https://check.torproject.org/api/ip | grep -q 'IsTor.*true' || exit 1"]
      interval: 60s
      timeout: 30s
      retries: 3
      start_period: 60s
