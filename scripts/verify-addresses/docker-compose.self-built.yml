# Bitcoin Core container using self-built image
#
# This docker-compose file uses the sanctuary-bitcoind image built from
# verified source (see ../bitcoin-core-docker/). This eliminates trust
# in third-party Docker images.
#
# Prerequisites:
#   cd ../bitcoin-core-docker && ./build.sh 27.0
#
# Usage:
#   docker compose -f docker-compose.self-built.yml up -d

services:
  bitcoind:
    image: sanctuary-bitcoind:27.0
    container_name: bitcoind-verify
    command:
      - -regtest
      - -server
      - -rpcuser=verify
      - -rpcpassword=verify
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -fallbackfee=0.0001
    ports:
      - "18553:18443"  # Regtest RPC port (mapped to non-standard port)
    volumes:
      - bitcoind-verify-data:/home/bitcoin/.bitcoin
    healthcheck:
      test: ["CMD", "bitcoin-cli", "-regtest", "-rpcuser=verify", "-rpcpassword=verify", "getblockchaininfo"]
      interval: 5s
      timeout: 10s
      retries: 5

volumes:
  bitcoind-verify-data:
