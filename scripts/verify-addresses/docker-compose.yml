# Bitcoin Core container for address verification
# Used to generate reference addresses via deriveaddresses RPC
#
# OPTIONS:
# 1. Use this file (quick start, uses ruimarinho/bitcoin-core image)
# 2. Use docker-compose.self-built.yml (builds from verified source - more secure)
#
# For maximum security, build your own image:
#   cd ../bitcoin-core-docker && ./build.sh 27.0
#   docker compose -f docker-compose.self-built.yml up -d
#
# Or use the existing beacon-bitcoind container if running (see bitcoincore.ts)

services:
  bitcoind:
    image: ruimarinho/bitcoin-core:24-alpine
    container_name: bitcoind-verify
    command:
      - -regtest
      - -server
      - -rpcuser=verify
      - -rpcpassword=verify
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -fallbackfee=0.0001
    ports:
      - "18553:18443"  # Regtest RPC port (mapped to avoid conflict)
    volumes:
      - bitcoind-data:/home/bitcoin/.bitcoin
    healthcheck:
      test: ["CMD", "bitcoin-cli", "-regtest", "-rpcuser=verify", "-rpcpassword=verify", "getblockchaininfo"]
      interval: 5s
      timeout: 10s
      retries: 5

volumes:
  bitcoind-data:
