# Bitcoin Core for PSBT Cross-Verification
#
# This runs Bitcoin Core in regtest mode for verifying our PSBT implementation
# against the reference Bitcoin implementation.
#
# Usage:
#   docker compose up -d     # Start Bitcoin Core
#   docker compose down      # Stop Bitcoin Core
#
# RPC access:
#   docker exec bitcoin-core bitcoin-cli -regtest getblockchaininfo

services:
  bitcoin-core:
    image: ruimarinho/bitcoin-core:27
    container_name: bitcoin-core
    restart: unless-stopped
    ports:
      - "18443:18443"  # Regtest RPC
      - "18444:18444"  # Regtest P2P
    volumes:
      - bitcoin-data:/home/bitcoin/.bitcoin
    command:
      - -regtest=1
      - -server=1
      - -rpcuser=sanctuary
      - -rpcpassword=sanctuary-verify
      - -rpcallowip=0.0.0.0/0
      - -rpcbind=0.0.0.0
      - -fallbackfee=0.00001
      - -txindex=1
      - -printtoconsole=1
    healthcheck:
      test: ["CMD", "bitcoin-cli", "-regtest", "-rpcuser=sanctuary", "-rpcpassword=sanctuary-verify", "getblockchaininfo"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 30s

volumes:
  bitcoin-data:
